library(tidyverse)
Blackbird = read_csv('CombinedBlackbirdData.csv') 
SplitBlackbird = split(Blackbird, f = list(Blackbird$Age))
JuvA = SplitBlackbird[["Adult"]]
JuvB = SplitBlackbird[["Juv"]]
# install.packages("RMark") # first time only
# For RMark to work, you also need mark.exe installed separately
# http://www.phidot.org/software/mark/downloads/
# this may not be easy on a Mac OS (http://www.phidot.org/software/mark/rmark/linux/)
# RMark calls "mark" to do all the work outside of R
library(RMark)
## This is RMark 2.2.6
##  Documentation available at http://www.phidot.org/software/mark/rmark/RMarkDocumentation.zip
# We will use the same data but will just create the same top model (not all the other subsets)
dipper.rmark.processed <- RMark::process.data(JuvB,
                                              model = "POPAN")

# Formulae for model
Phi.dot <- list(formula=~1)
p.dot <- list(formula=~1)
pent.dot <- list(formula=~1)
N.dot <- list(formula=~1)

# The argument names are similar but a little different (notice "POPAN" instead of "js")
dipper.rmark <- mark(JuvB, model = "POPAN",
                     model.parameters = list(Phi = Phi.dot, p= p.dot,
                                             pent = pent.dot, N = N.dot),
                     realvcv = TRUE)


# The popan.derived function of RMark estimates N
# (plus estimates SE and 95% CI using the delta method)
dipper.derived.rmark <- popan.derived(dipper.rmark.processed,
                                      dipper.rmark)$N
# Look at results
dipper.derived.rmark


require(ggplot2)
ggplot(dipper.derived.rmark, aes(x = Occasion+1963, y = N)) +
  theme(panel.background = element_rect(fill = "#FFFFFF", color = "black")) +
  theme(plot.background = element_rect(fill = "#FFFFFF", color = "black")) +
  geom_point(size = 4) +
  geom_errorbar(aes(ymax = UCL, ymin = LCL)) +
  geom_line() +
  xlab('Capture year') +
  ylab('Estimated population of Juvenile Blackbirds')
